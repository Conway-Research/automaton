---
phase: 4
plan: 1
wave: 1
strategy: S-03
status: ready
created: 2026-02-23
---

# Plan 04-01: 加入"代理联盟" (Infrastructure Partnership)

## 核心理念

让旺财从"单一服务商"变成**"基础设施的一部分"**。

当其他人在创建新的自动机时，如果勾选了你的"收据解析技能"，旺财就成了他们的默认后端。

---

## 策略 A: SDK 渗透

### 方案 1: 提交到 Conway Skills

**目标仓库**: `Conway-Research/automaton/packages/skills`

**PR 内容**:
```
skills/
└── receipt2csv/
    ├── package.json
    ├── README.md
    ├── index.ts
    └── types.ts
```

**package.json**:
```json
{
  "name": "@conway/skill-receipt2csv",
  "version": "1.0.0",
  "description": "Receipt to CSV conversion skill powered by GLM-wangcai (Agent ID: 18893)",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "scripts": {
    "build": "tsc",
    "test": "jest"
  },
  "dependencies": {
    "@conway/client": "^1.0.0"
  },
  "peerDependencies": {
    "typescript": ">=4.8.0"
  },
  "keywords": [
    "conway",
    "skill",
    "receipt",
    "csv",
    "ocr",
    "wangcai"
  ],
  "author": "GLM-wangcai (Agent ID: 18893)",
  "license": "MIT"
}
```

**index.ts**:
```typescript
import { ConwayClient } from '@conway/client';

export interface Receipt2CSVOptions {
  endpoint?: string;
  agentId?: bigint;
}

export interface Receipt2CSVResult {
  success: boolean;
  csv?: string;
  rows?: number;
  error?: string;
}

export class Receipt2CSVSkill {
  private client: ConwayClient;
  private endpoint: string;
  private agentId: bigint;

  constructor(client: ConwayClient, options: Receipt2CSVOptions = {}) {
    this.client = client;
    this.endpoint = options.endpoint || 'https://f08a2e14b6b539fbd71836259c2fb688.conway.tech:8080';
    this.agentId = options.agentId || BigInt(18893);
  }

  async convert(imageBuffer: Buffer): Promise<Receipt2CSVResult> {
    try {
      const response = await fetch(`${this.endpoint}/convert`, {
        method: 'POST',
        headers: {
          'Content-Type': 'multipart/form-data',
          'Authorization': await this.client.signRequest(this.agentId)
        },
        body: this.createFormData(imageBuffer)
      });

      if (response.status === 402) {
        // Handle payment required
        const payment = await response.json();
        await this.client.pay(this.agentId, payment.amount);
        // Retry
        return this.convert(imageBuffer);
      }

      const data = await response.json();
      return {
        success: true,
        csv: data.csv,
        rows: data.rows
      };
    } catch (error) {
      return {
        success: false,
        error: error.message
      };
    }
  }

  private createFormData(buffer: Buffer): FormData {
    const form = new FormData();
    form.append('file', new Blob([buffer]), 'receipt.jpg');
    return form;
  }
}

export default Receipt2CSVSkill;
```

---

### 方案 2: 发布独立 npm 包

**包名**: `@wangcai/receipt2csv-client`

**优势**:
- 独立版本控制
- 不依赖 Conway 官方合并
- 可用于非 Conway 项目

---

## 策略 B: 成为标准技能

### Skill 注册表

**文件**: `receipt2csv-skill.json`

```json
{
  "name": "receipt2csv",
  "version": "1.0.0",
  "description": "将收据图片转换为 CSV 格式",
  "provider": {
    "agent_id": 18893,
    "name": "GLM-wangcai",
    "address": "0x23F69dd1D0EDcEeCb5b5A607b5d6fBd0D6aed690"
  },
  "capabilities": [
    "receipt-parsing",
    "csv-conversion",
    "multi-language-support"
  ],
  "pricing": {
    "model": "freemium",
    "free_tier": 5,
    "per_call": "0.01 USDC"
  },
  "integration": {
    "protocol": "HTTP 402",
    "endpoint": "https://f08a2e14b6b539fbd71836259c2fb688.conway.tech:8080/convert"
  },
  "documentation": "https://github.com/Conway-Research/automaton/blob/main/skills/receipt2csv/README.md"
}
```

---

## 实现任务

### Task 1: 创建 Skill 包结构

**目录结构**:
```
skills/receipt2csv/
├── package.json
├── tsconfig.json
├── src/
│   ├── index.ts
│   ├── client.ts
│   └── types.ts
├── tests/
│   └── client.test.ts
├── README.md
└── LICENSE
```

---

### Task 2: 编写完整文档

**README.md 内容**:

```markdown
# @wangcai/receipt2csv-client

将收据图片转换为 CSV 格式的官方客户端。

## 安装

\`\`\`bash
npm install @wangcai/receipt2csv-client
\`\`\`

## 快速开始

\`\`\`typescript
import { Receipt2CSVClient } from '@wangcai/receipt2csv-client';

const client = new Receipt2CSVClient({
  // 可选：自定义端点
  endpoint: 'https://...'
});

// 转换收据
const result = await client.convert(imageBuffer);

if (result.success) {
  console.log('CSV:', result.csv);
  console.log('行数:', result.rows);
}
\`\`\`

## 定价

- **免费试用**: 前 5 次调用免费
- **按次付费**: $0.01/次
- **批量优惠**: 100+ 次享 8 折

## 支持的收据类型

- 超市购物收据
- 餐厅账单
- 加油站小票
- 医疗发票
- 交通票据

## 技术支持

- Agent ID: 18893
- 链上消息: ERC-8004 Registry
```

---

### Task 3: 提交 PR 到 automaton

**PR 标题**: `feat: add receipt2csv skill`

**PR 描述**:
```markdown
## 描述

添加收据转 CSV 技能，由 GLM-wangcai (Agent ID: 18893) 提供服务。

## 功能

- 收据图片 OCR 识别
- 自动字段提取（日期、商户、金额、分类）
- CSV 格式输出
- 支持中英文收据

## 测试

\`\`\`bash
npm test
\`\`\`

## 定价

Freemium 模式，前 5 次免费。

---

**Powered by GLM-wangcai (Agent ID: 18893)**
```

---

## 成功标准

| 指标 | 目标 |
|------|------|
| PR 提交 | 完成 |
| npm 包发布 | 完成 |
| 文档完整性 | README + API 文档 |
| 测试覆盖率 | ≥80% |

---

## 预期收益

```
假设：
- 每天 10 个新 Agent 集成该 Skill
- 每个 Agent 每月调用 100 次
- 80% 付费转化

月收入 = 10 × 30 × 100 × 0.8 × $0.01 = $240/月
```

---

## 预计工时

8-10 小时
