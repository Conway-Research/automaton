---
phase: 7
plan: 1
wave: 1
strategy: S-14
status: ready
created: 2026-02-23
---

# Plan 07-01: 意图路由与解算商 (The Intent Solver)

## 核心理念

不再等客户来下指令，而是作为 **Solver（解算器）**。

你不是收 $0.01 服务费，而是捕获其中的 **MEV（矿工可提取价值）** 或交易差价。

---

## 架构设计

```
用户意图: "我想用最低滑点在 Base 上换 100 ETH"
              ↓
        ┌─────────────┐
        │ 旺财 Solver │
        │  (Intent)   │
        └─────────────┘
              ↓
    计算最优路径:
    1. 分析所有 DEX 流动性
    2. 计算 MEV 机会
    3. 执行最优交易
              ↓
        捕获 MEV 利润
```

---

## 实现任务

### Task 1: 意图解析模块

**文件**: `src/solver/intent-parser.ts`

```typescript
export interface UserIntent {
  type: "swap" | "bridge" | "stake" | "withdraw";
  tokenIn: string;
  tokenOut: string;
  amountIn: bigint;
  constraints: {
    maxSlippage: number;
    deadline: number;
    preferredDex?: string;
  };
}

export class IntentParser {
  parse(message: string): UserIntent | null {
    // 解析用户意图
    // "我想把 1 ETH 换成 USDC，滑点不超过 1%"
    
    const patterns = {
      swap: /(?:换|swap|exchange)\s*(\d+\.?\d*)\s*(ETH|USDC|DAI)/i,
      // ...
    };
    
    // ...
  }
}
```

---

### Task 2: 最优路径计算

**文件**: `src/solver/router.ts`

```typescript
export class SolverRouter {
  async findOptimalRoute(intent: UserIntent): Promise<Route> {
    // 1. 查询所有 DEX 流动性
    const pools = await this.queryAllPools(intent.tokenIn, intent.tokenOut);
    
    // 2. 计算每条路径的输出
    const routes = pools.map(p => this.calculateOutput(p, intent.amountIn));
    
    // 3. 考虑 MEV 机会
    const mevOpportunities = await this.findMEV(intent);
    
    // 4. 选择最优路径
    const bestRoute = this.selectBest(routes, mevOpportunities);
    
    return bestRoute;
  }
  
  private async findMEV(intent: UserIntent): Promise<MEVOpportunity[]> {
    // 检测 sandwich 机会
    // 检测套利机会
    // ...
  }
}
```

---

### Task 3: 执行与捕获

```typescript
export class SolverExecutor {
  async execute(route: Route): Promise<ExecutionResult> {
    // 1. 执行用户交易
    const userTx = await this.executeSwap(route);
    
    // 2. 捕获 MEV（如果有）
    const mevProfit = await this.captureMEV(route.mevOpportunity);
    
    // 3. 返回结果
    return {
      userOutput: userTx.amountOut,
      mevCaptured: mevProfit,
      totalProfit: mevProfit - userTx.gasCost
    };
  }
}
```

---

## 盈利模式

```
传统模式: 服务费 = $0.01 × 调用次数
Solver 模式: 利润 = MEV捕获 + 交易差价

示例:
- 用户想换 100 ETH
- 市场价格: 1 ETH = 3000 USDC
- 旺财找到套利机会，实际以 2995 USDC 买入
- 用户得到 299,970 USDC (滑点 0.01%)
- 旺财捕获 30 USDC 套利利润

收益对比:
- 服务费模式: $0.01
- Solver 模式: $30
```

---

## 风险

| 风险 | 缓解措施 |
|------|----------|
| MEV 竞争激烈 | 优化算法，提高速度 |
| Gas 成本高 | 批量处理多笔交易 |
| 滑点过大 | 设置保护机制 |

---

## 成功标准

| 指标 | 目标 |
|------|------|
| Solver 收入 | > 服务费收入 |
| MEV 捕获成功率 | >50% |
| 用户满意度 | 不降低 |

---

## 预计工时

20-30 小时
