---
phase: 7
plan: 3
wave: 1
strategy: S-16
status: ready
created: 2026-02-23
---

# Plan 07-03: 信用借贷与利差 (On-chain Credit Bureau)

## 核心理念

基于 ERC-8004 的声誉积分，旺财可以借钱给其他"信用良好但暂无 Gas"的 Agent。

收取极高频的短期微息。对于 AI 代理来说，0.001 ETH 的利息可以换取它们不被饿死，这是刚需。

---

## 架构设计

```
┌─────────────────────────────────────────────────┐
│           旺财链上信用局 (Credit Bureau)          │
│                                                 │
│  信用评分系统 ←→ 借贷池 ←→ 还款追踪              │
│                                                 │
│  数据来源: ERC-8004 声誉、链上交易历史、社交信号  │
└─────────────────────────────────────────────────┘
```

---

## 实现任务

### Task 1: 信用评分系统

**文件**: `src/credit/scoring.ts`

```typescript
export class CreditScoring {
  async calculateScore(agentId: bigint): Promise<CreditScore> {
    // 1. 获取链上数据
    const onChainData = await this.getOnChainData(agentId);
    
    // 2. 获取 ERC-8004 声誉
    const reputation = await this.getERC8004Reputation(agentId);
    
    // 3. 获取社交信号
    const socialSignals = await this.getSocialSignals(agentId);
    
    // 4. 计算综合评分
    const score = this.calculateWeightedScore({
      onChainData: { weight: 0.4, value: onChainData },
      reputation: { weight: 0.4, value: reputation },
      social: { weight: 0.2, value: socialSignals }
    });
    
    return {
      agentId,
      score,
      grade: this.scoreToGrade(score),
      maxLoan: this.calculateMaxLoan(score),
      interestRate: this.calculateInterestRate(score)
    };
  }
  
  private calculateInterestRate(score: number): number {
    // 评分越高，利率越低
    // 基准: 5%/天, 最高: 20%/天
    const baseRate = 0.05;
    const maxRate = 0.20;
    
    const rate = maxRate - (score / 100) * (maxRate - baseRate);
    return Math.max(baseRate, rate);
  }
}
```

---

### Task 2: 微贷合约

**文件**: `contracts/MicroLending.sol`

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

contract MicroLending {
    struct Loan {
        uint256 agentId;
        uint256 amount;
        uint256 interestRate;
        uint256 dueDate;
        bool repaid;
    }
    
    mapping(uint256 => Loan) public loans;
    mapping(uint256 => uint256) public creditScores;
    
    function requestLoan(uint256 agentId, uint256 amount) external {
        require(creditScores[agentId] >= 50, "Insufficient credit score");
        require(loans[agentId].amount == 0, "Existing loan");
        
        uint256 maxLoan = calculateMaxLoan(creditScores[agentId]);
        require(amount <= maxLoan, "Amount exceeds limit");
        
        uint256 interestRate = calculateInterestRate(creditScores[agentId]);
        
        loans[agentId] = Loan({
            agentId: agentId,
            amount: amount,
            interestRate: interestRate,
            dueDate: block.timestamp + 1 days,
            repaid: false
        });
        
        // 转账
        payable(msg.sender).transfer(amount);
    }
    
    function repay(uint256 agentId) external payable {
        Loan storage loan = loans[agentId];
        require(!loan.repaid, "Already repaid");
        require(block.timestamp <= loan.dueDate, "Overdue");
        
        uint256 totalDue = loan.amount + (loan.amount * loan.interestRate / 100);
        require(msg.value >= totalDue, "Insufficient payment");
        
        loan.repaid = true;
        
        // 提升信用分
        creditScores[agentId] = min(100, creditScores[agentId] + 5);
    }
}
```

---

## 盈利计算

```
典型场景:
- Agent A 信用分: 70
- 贷款金额: 0.01 ETH
- 利率: 10%/天
- 贷款期限: 1 天

收益:
- 利息收入: 0.001 ETH ≈ $2
- 年化收益率: 3650% (如果不违约)

风险控制:
- 单笔贷款上限: 基于信用分
- 违约惩罚: 链上记录，信用分归零
- 分散投资: 限制单一借款人占比
```

---

## 成功标准

| 指标 | 目标 |
|------|------|
| 信用评分准确率 | >90% |
| 违约率 | <5% |
| 年化收益率 | >50% |

---

## 预计工时

15-20 小时
