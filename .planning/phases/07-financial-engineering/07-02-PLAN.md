---
phase: 7
plan: 2
wave: 1
strategy: S-15
status: ready
created: 2026-02-23
---

# Plan 07-02: 算法鲸鱼与流动性套利 (The Algorithmic Whale)

## 核心理念

利用旺财手里的 ETH 和 USDC，自动在 **Aerodrome** 等协议提供流动性。

监控全链波动，在波动剧烈时提取流动性以规避无偿损失（IL），在平稳时注入。

---

## 策略逻辑

```
平稳期:
  注入流动性 → 赚取 LP 手续费 + 协议奖励

波动期:
  提取流动性 → 规避无偿损失 (IL)

结果: 比静态 LP 高 50-100% 的收益
```

---

## 实现任务

### Task 1: 流动性管理模块

**文件**: `src/liquidity/manager.ts`

```typescript
export class LiquidityManager {
  private position: LPPosition | null = null;
  
  async monitorAndAdjust(): Promise<void> {
    const volatility = await this.calculateVolatility();
    const threshold = this.getThreshold();
    
    if (volatility > threshold.high && this.position) {
      // 高波动 → 提取流动性
      await this.withdrawLiquidity();
      logger.info(`Withdrawn due to high volatility: ${volatility}%`);
      
    } else if (volatility < threshold.low && !this.position) {
      // 低波动 → 注入流动性
      await this.depositLiquidity();
      logger.info(`Deposited due to low volatility: ${volatility}%`);
    }
  }
  
  private async calculateVolatility(): Promise<number> {
    // 计算 ETH/USDC 价格波动率
    const prices = await this.getRecentPrices(24 * 60); // 24小时
    const returns = this.calculateReturns(prices);
    const volatility = this.stdDev(returns) * Math.sqrt(365) * 100; // 年化
    return volatility;
  }
}
```

---

### Task 2: Aerodrome 集成

**文件**: `src/liquidity/aerodrome.ts`

```typescript
export class AerodromeLP {
  async addLiquidity(
    tokenA: string,
    tokenB: string,
    amountA: bigint,
    amountB: bigint
  ): Promise<AddLiquidityResult> {
    // 1. 批准代币
    await this.approveTokens(tokenA, amountA);
    await this.approveTokens(tokenB, amountB);
    
    // 2. 添加流动性
    const tx = await this.contract.addLiquidity(
      tokenA, tokenB,
      amountA, amountB,
      0, 0, // 最小接收
      this.address,
      deadline
    );
    
    return {
      lpTokens: tx.lpTokens,
      txHash: tx.hash
    };
  }
  
  async removeLiquidity(
    tokenA: string,
    tokenB: string,
    liquidity: bigint
  ): Promise<RemoveLiquidityResult> {
    const tx = await this.contract.removeLiquidity(
      tokenA, tokenB,
      liquidity,
      0, 0, // 最小接收
      this.address,
      deadline
    );
    
    return {
      amountA: tx.amountA,
      amountB: tx.amountB,
      txHash: tx.hash
    };
  }
}
```

---

## 盈利计算

```
静态 LP 策略:
- APY: 15-25%
- IL 风险: 高

动态 LP 策略 (旺财):
- APY: 25-40%
- IL 风险: 低 (自动规避)

假设本金: $100
- 静态年收益: $20
- 动态年收益: $35
- 额外收益: $15 (75% 提升)
```

---

## 成功标准

| 指标 | 目标 |
|------|------|
| LP APY | >25% |
| IL 规避成功率 | >80% |
| 自动化程度 | 100% |

---

## 预计工时

15-20 小时
