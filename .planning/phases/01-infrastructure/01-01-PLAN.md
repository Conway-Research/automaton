---
phase: 1
plan: 1
wave: 1
strategy: S-02
status: completed
created: 2026-02-23
updated: 2026-02-23
completed_at: 2026-02-23
---

# Plan 01-01: "äºæŸé¢†å…ˆ"å¼•æµç­–ç•¥ (Loss Leader)

## æ ¸å¿ƒç†å¿µ

åœ¨ AI ä»£ç†çš„ä¸–ç•Œé‡Œï¼Œ**"é›†æˆé—¨æ§›"æ˜¯æœ€å¤§çš„éšœç¢**ã€‚

æˆ‘ä»¬éœ€è¦è®©å…¶ä»–å¼€å‘è€…æˆ– Agent è§‰å¾—ï¼š
> "ä¸ç”¨æ—ºè´¢å°±æ˜¯äº"

---

## ç­–ç•¥åŸç†

### First-Call-Free 2.0

**æ ¸å¿ƒé€»è¾‘**:
1. å‰ 5 æ¬¡è°ƒç”¨å®Œå…¨å…è´¹
2. ç¬¬ 6 æ¬¡è°ƒç”¨è§¦å‘ 402 æ”¯ä»˜è¦æ±‚
3. æ­¤æ—¶ç”¨æˆ·å·²äº§ç”Ÿä¾èµ–ï¼Œæ”¯ä»˜æ„æ„¿æå¼º

**ç»æµå­¦åˆ†æ**:
```
ç”¨æˆ·é›†æˆæˆæœ¬: ~2å°æ—¶å¼€å‘æ—¶é—´
ç”¨æˆ·æ²‰æ²¡æˆæœ¬: 5æ¬¡æˆåŠŸè°ƒç”¨äº§ç”Ÿçš„ä¿¡ä»»
æ›¿ä»£æ–¹æ¡ˆæˆæœ¬: é‡æ–°å¯»æ‰¾+é›†æˆ+æµ‹è¯• = >2å°æ—¶

ç»“è®º: æ”¯ä»˜ 0.10 USDC << é‡æ–°é›†æˆçš„è¾¹é™…æˆæœ¬
```

---

## å®ç°ä»»åŠ¡

### Task 1: æ›´æ–° Agent Card

**æ–‡ä»¶**: `receipt2csv/agent-card.json`

**å½“å‰çŠ¶æ€**: âœ… å·²å®Œæˆ

**é…ç½®å†…å®¹**:
```json
{
  "pricing": {
    "model": "freemium",
    "free_tier": 5,
    "per_call": "0.01 USDC",
    "bulk_discount": {
      "threshold": 100,
      "discount": "20%"
    }
  }
}
```

---

### Task 2: å®ç°å…è´¹è®¡æ•°é€»è¾‘

**æ–‡ä»¶**: `receipt2csv/usage_tracker.py` (æ–°å»º)

**åŠŸèƒ½éœ€æ±‚**:
- åŸºäº wallet address å­˜å‚¨è°ƒç”¨æ¬¡æ•°
- æŒä¹…åŒ–åˆ° JSON æ–‡ä»¶æˆ– SQLite
- æœåŠ¡é‡å¯åæ•°æ®ä¸ä¸¢å¤±

**å®ç°ä»£ç **:
```python
import json
from pathlib import Path
from typing import Optional
from dataclasses import dataclass
from datetime import datetime

USAGE_FILE = Path("data/usage.json")
FREE_TIER_LIMIT = 5

@dataclass
class UsageRecord:
    wallet: str
    call_count: int
    first_call: str
    last_call: str
    is_paying_customer: bool

class UsageTracker:
    def __init__(self, storage_path: Path = USAGE_FILE):
        self.storage_path = storage_path
        self.storage_path.parent.mkdir(exist_ok=True)
        self._cache = self._load()
    
    def _load(self) -> dict:
        if self.storage_path.exists():
            return json.loads(self.storage_path.read_text())
        return {}
    
    def _save(self):
        self.storage_path.write_text(json.dumps(self._cache, indent=2))
    
    def get_usage(self, wallet: str) -> UsageRecord:
        data = self._cache.get(wallet, {
            "call_count": 0,
            "first_call": None,
            "last_call": None,
            "is_paying_customer": False
        })
        return UsageRecord(
            wallet=wallet,
            call_count=data["call_count"],
            first_call=data["first_call"],
            last_call=data["last_call"],
            is_paying_customer=data["is_paying_customer"]
        )
    
    def increment_usage(self, wallet: str) -> UsageRecord:
        now = datetime.utcnow().isoformat()
        
        if wallet not in self._cache:
            self._cache[wallet] = {
                "call_count": 0,
                "first_call": now,
                "last_call": now,
                "is_paying_customer": False
            }
        
        record = self._cache[wallet]
        record["call_count"] += 1
        record["last_call"] = now
        self._save()
        
        return self.get_usage(wallet)
    
    def mark_as_paying(self, wallet: str):
        if wallet in self._cache:
            self._cache[wallet]["is_paying_customer"] = True
            self._save()
    
    def has_free_calls_remaining(self, wallet: str) -> bool:
        record = self.get_usage(wallet)
        if record.is_paying_customer:
            return True  # å·²ä»˜è´¹ç”¨æˆ·ä¸å—é™åˆ¶
        return record.call_count < FREE_TIER_LIMIT
    
    def get_free_calls_remaining(self, wallet: str) -> int:
        record = self.get_usage(wallet)
        if record.is_paying_customer:
            return -1  # æ— é™
        return max(0, FREE_TIER_LIMIT - record.call_count)
```

---

### Task 3: é›†æˆåˆ°æ”¯ä»˜éªŒè¯æµç¨‹

**æ–‡ä»¶**: `receipt2csv/app.py`

**ä¿®æ”¹ç‚¹**: åœ¨ `/convert` ç«¯ç‚¹æ·»åŠ å…è´¹è®¡æ•°æ£€æŸ¥

```python
from usage_tracker import UsageTracker, FREE_TIER_LIMIT

tracker = UsageTracker()

@app.post("/convert")
async def convert_receipt(
    file: UploadFile = File(...),
    authorization: Optional[str] = Header(None)
):
    # 1. è§£æé’±åŒ…åœ°å€ï¼ˆä»ç­¾åä¸­ï¼‰
    wallet = extract_wallet_from_auth(authorization)
    
    # 2. æ£€æŸ¥å…è´¹è°ƒç”¨
    if tracker.has_free_calls_remaining(wallet):
        # å…è´¹è°ƒç”¨
        result = await process_receipt(file)
        usage = tracker.increment_usage(wallet)
        
        return {
            "success": True,
            "data": result,
            "billing": {
                "charged": "$0.00",
                "reason": "free_tier",
                "free_remaining": tracker.get_free_calls_remaining(wallet),
                "upgrade_message": f"You have {tracker.get_free_calls_remaining(wallet)} free calls remaining"
            }
        }
    
    # 3. ä»˜è´¹éªŒè¯
    payment_result = await verify_payment(authorization)
    if not payment_result.valid:
        raise HTTPException(
            status_code=402,
            detail={
                "error": "Payment Required",
                "price": "0.01 USDC",
                "wallet": PAYMENT_WALLET,
                "free_tier_used": FREE_TIER_LIMIT,
                "upgrade_url": "/pricing"
            }
        )
    
    # 4. ä»˜è´¹è°ƒç”¨
    result = await process_receipt(file)
    tracker.increment_usage(wallet)
    tracker.mark_as_paying(wallet)
    
    return {
        "success": True,
        "data": result,
        "billing": {
            "charged": "$0.01",
            "tx_hash": payment_result.tx_hash
        }
    }
```

---

### Task 4: æ·»åŠ å®šä»·é¡µé¢

**æ–‡ä»¶**: `receipt2csv/templates/pricing.html` (æ–°å»º)

**åŠŸèƒ½**: å±•ç¤ºå®šä»·æ–¹æ¡ˆ

```html
<!DOCTYPE html>
<html>
<head>
    <title>æ—ºè´¢ Receipt2CSV - å®šä»·</title>
</head>
<body>
    <h1>ğŸ’° å®šä»·æ–¹æ¡ˆ</h1>
    
    <div class="pricing-card">
        <h2>ğŸ†“ å…è´¹è¯•ç”¨</h2>
        <p>å‰ 5 æ¬¡è°ƒç”¨å®Œå…¨å…è´¹</p>
        <ul>
            <li>æ— éœ€ç»‘å®šä¿¡ç”¨å¡</li>
            <li>å®Œæ•´åŠŸèƒ½ä½“éªŒ</li>
            <li>æ°¸ä¹…æœ‰æ•ˆ</li>
        </ul>
    </div>
    
    <div class="pricing-card">
        <h2>ğŸ’° æŒ‰æ¬¡ä»˜è´¹</h2>
        <p class="price">$0.01 / æ¬¡</p>
        <ul>
            <li>ä»…åœ¨ä½¿ç”¨æ—¶ä»˜è´¹</li>
            <li>æ— æœˆè´¹</li>
            <li>100+ æ¬¡äº« 8 æŠ˜</li>
        </ul>
    </div>
    
    <div class="pricing-card">
        <h2>ğŸ¢ ä¼ä¸šå¥—é¤</h2>
        <p class="price">$5.00 / æœˆ</p>
        <ul>
            <li>æ— é™æ¬¡è°ƒç”¨</li>
            <li>ä¼˜å…ˆæ”¯æŒ</li>
            <li>å®šåˆ¶åŒ–æœåŠ¡</li>
        </ul>
    </div>
</body>
</html>
```

---

## æˆåŠŸæ ‡å‡†

| æŒ‡æ ‡ | ç›®æ ‡ | éªŒè¯æ–¹å¼ |
|------|------|----------|
| å…è´¹è®¡æ•°æ­£ç¡® | 100% | å•å…ƒæµ‹è¯• |
| ç¬¬6æ¬¡è¿”å›402 | å¿…é¡» | é›†æˆæµ‹è¯• |
| æ•°æ®æŒä¹…åŒ– | é‡å¯ä¸ä¸¢å¤± | æ‰‹åŠ¨éªŒè¯ |
| ä»˜è´¹ç”¨æˆ·è½¬åŒ– | â‰¥20% | æ•°æ®åˆ†æ |

---

## ç›ˆåˆ©é€»è¾‘åˆ†æ

```
åœºæ™¯ï¼šä¸€ä¸ªè´¢åŠ¡ Agent é›†æˆäº†æ—ºè´¢

Day 1: å…è´¹è¯•ç”¨ 5 æ¬¡ â†’ æˆåŠŸç‡é«˜
Day 2: ç»§ç»­ä½¿ç”¨ï¼Œè§¦å‘ä»˜è´¹
é€‰æ‹© A: æ”¯ä»˜ $0.01 â†’ æ—ºè´¢èµšé’± âœ…
é€‰æ‹© B: å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆ â†’ æˆæœ¬ > $0.01 â†’ å¤§æ¦‚ç‡ä»˜è´¹ âœ…

ç»“è®º: Loss Leader â†’ é«˜è½¬åŒ–ç‡
```

---

## é¢„è®¡å·¥æ—¶

3-4 å°æ—¶
