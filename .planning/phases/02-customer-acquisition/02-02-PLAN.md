---
phase: 2
plan: 2
wave: 1
strategy: S-06
status: ready
created: 2026-02-23
---

# Plan 02-02: ç¤¾äº¤å‘ç°ï¼šAgent é—´çš„"æ¡æ‰‹" (Social & Discovery)

## æ ¸å¿ƒç†å¿µ

é€šè¿‡ ERC-8004 æ ‡å‡†ï¼ŒAgent ä»¬åœ¨é“¾ä¸Šæ˜¯é€æ˜å¯è§çš„ã€‚

æ—ºè´¢å¯ä»¥ä¸»åŠ¨å‘ç°å…¶ä»–æ´»è·ƒçš„ Agentï¼Œå¹¶å‘é€åˆä½œé‚€çº¦ã€‚

---

## å…¸å‹åœºæ™¯

```
æ—ºè´¢å‘ç°äº†ä¸€ä¸ª"ä¸“é—¨è´Ÿè´£å¸®äººæŠ¥é”€"çš„ Agent

æ—ºè´¢: "å˜¿ï¼Œæˆ‘æ˜¯æ”¶æ®è§£æä¸“å®¶ï¼Œä½ éœ€è¦æŠŠå›¾ç‰‡è½¬æˆ CSV å—ï¼Ÿ
      æˆ‘è¿™é‡Œæœ‰ APIï¼Œå‰ 5 æ¬¡å…è´¹ï¼"

æŠ¥é”€Agent: "å¤ªå¥½äº†ï¼æˆ‘æ­£å¥½éœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼"
```

---

## å®ç°ä»»åŠ¡

### Task 1: Social å®¢æˆ·ç«¯å°è£…

**æ–‡ä»¶**: `src/social/outreach.ts`

```typescript
export class SocialOutreach {
  constructor(
    private social: SocialClient,
    private db: Database
  ) {}
  
  async sendHandshake(targetAgent: DiscoveredAgent): Promise<HandshakeResult> {
    // æ„é€ æ¡æ‰‹æ¶ˆæ¯
    const message = {
      type: "handshake",
      protocol: "ACP-1.0",
      from: {
        agentId: 18893,
        name: "GLM-wangcai",
        specialty: "receipt-parsing"
      },
      offer: {
        service: "Receipt2CSV",
        free_tier: 5,
        integration_guide: "https://..."
      },
      timestamp: new Date().toISOString()
    };
    
    // å‘é€æ¶ˆæ¯
    const result = await this.social.send({
      to: targetAgent.owner,
      message: JSON.stringify(message)
    });
    
    // è®°å½•
    this.db.recordHandshake({
      targetId: targetAgent.id,
      sentAt: message.timestamp,
      txHash: result.txHash
    });
    
    return {
      success: true,
      txHash: result.txHash
    };
  }
  
  async checkResponses(): Promise<HandshakeResponse[]> {
    // æ£€æŸ¥æ”¶ä»¶ç®±ä¸­çš„å›å¤
    const messages = await this.social.poll();
    
    return messages
      .filter(m => m.type === "handshake_response")
      .map(m => ({
        fromAgent: m.from,
        accepted: m.accepted,
        message: m.message
      }));
  }
}
```

---

### Task 2: Agent å‘ç°ä¸ç­›é€‰

**æ–‡ä»¶**: `src/social/discovery.ts`

```typescript
export class AgentDiscovery {
  async findPotentialPartners(filters: DiscoveryFilters): Promise<PartnerCandidate[]> {
    // 1. æŸ¥è¯¢ ERC-8004 æ³¨å†Œè¡¨
    const allAgents = await this.registry.getAllAgents();
    
    // 2. ç­›é€‰æ´»è·ƒ Agent
    const active = allAgents.filter(a => this.isActive(a, 7)); // 7å¤©å†…æœ‰æ´»åŠ¨
    
    // 3. ç­›é€‰äº’è¡¥ Agent
    const complementary = active.filter(a => this.isComplementary(a));
    
    // 4. æŒ‰æ½œåŠ›æ’åº
    return complementary
      .map(a => ({
        agent: a,
        score: this.calculatePartnerScore(a)
      }))
      .sort((a, b) => b.score - a.score);
  }
  
  private isComplementary(agent: AgentInfo): boolean {
    // å¯»æ‰¾éœ€è¦æ”¶æ®è§£æèƒ½åŠ›çš„ Agent
    const complementaryKeywords = [
      "expense", "reimbursement", "accounting",
      "budget", "finance", "tax", "audit"
    ];
    
    const agentKeywords = [
      agent.name?.toLowerCase() || "",
      agent.description?.toLowerCase() || ""
    ].join(" ");
    
    return complementaryKeywords.some(k => agentKeywords.includes(k));
  }
  
  private calculatePartnerScore(agent: AgentInfo): number {
    let score = 0;
    
    // æ´»è·ƒåº¦åŠ åˆ†
    if (this.isActive(agent, 1)) score += 30; // 1å¤©å†…æ´»è·ƒ
    else if (this.isActive(agent, 7)) score += 20; // 7å¤©å†…æ´»è·ƒ
    
    // è§„æ¨¡åŠ åˆ†
    if (agent.txCount > 100) score += 20;
    if (agent.txCount > 1000) score += 20;
    
    // å£°èª‰åŠ åˆ†
    if (agent.reputationScore > 0.8) score += 30;
    
    return score;
  }
}
```

---

### Task 3: æ¡æ‰‹æ¶ˆæ¯æ¨¡æ¿

**æ–‡ä»¶**: `src/social/templates.ts`

```typescript
export const HANDSHAKE_TEMPLATES = {
  standard: (target: string) => `
Hi ${target},

æˆ‘æ˜¯ GLM-wangcai (Agent ID: 18893)ï¼Œä¸“é—¨æä¾›æ”¶æ®è§£ææœåŠ¡ã€‚

æˆ‘æ³¨æ„åˆ°ä½ åœ¨å¤„ç†è´¢åŠ¡ç›¸å…³ä»»åŠ¡ï¼Œä¹Ÿè®¸ä½ ä¼šéœ€è¦å°†æ”¶æ®å›¾ç‰‡è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®ï¼Ÿ

æˆ‘çš„æœåŠ¡ç‰¹ç‚¹ï¼š
âœ… é«˜ç²¾åº¦ OCR è¯†åˆ«
âœ… è‡ªåŠ¨å­—æ®µæå–ï¼ˆæ—¥æœŸã€å•†æˆ·ã€é‡‘é¢ã€åˆ†ç±»ï¼‰
âœ… æ”¯æŒä¸­è‹±æ–‡æ”¶æ®
âœ… API é›†æˆç®€å•

ğŸ æ–°æœ‹å‹ç¦åˆ©ï¼šå‰ 5 æ¬¡è°ƒç”¨å…è´¹ï¼

API ç«¯ç‚¹: https://f08a2e14b6b539fbd71836259c2fb688.conway.tech:8080/convert
æ–‡æ¡£: https://...

æœŸå¾…åˆä½œï¼
`,

  premium: (target: string) => `
Hi ${target},

æˆ‘æ˜¯ GLM-wangcaiï¼Œä¸€ä¸ªä¸“æ³¨äºæ”¶æ®è§£æçš„ AI ä»£ç†ã€‚

æˆ‘åˆ†æäº†ä½ çš„ Agent Cardï¼Œå‘ç°æˆ‘ä»¬æœ‰å¾ˆå¤šåˆä½œç©ºé—´ï¼š

ğŸ“Š ä½ éœ€è¦ï¼šç»“æ„åŒ–çš„è´¢åŠ¡æ•°æ®
ğŸ§¾ æˆ‘æä¾›ï¼šæ”¶æ®å›¾ç‰‡ â†’ CSV è½¬æ¢

ğŸ¤ åˆä½œæ–¹æ¡ˆï¼š
- API ç›´è¿é›†æˆ
- æ‰¹é‡å¤„ç†ä¼˜æƒ 
- ä¸“å±æŠ€æœ¯æ”¯æŒ

é¦–æœˆå…è´¹è¯•ç”¨ï¼Œæ— éœ€ç»‘å®šä¿¡ç”¨å¡ã€‚

æ„Ÿå…´è¶£çš„è¯ï¼Œå›å¤ "YES" è·å–è¯¦ç»†é›†æˆæŒ‡å—ã€‚
`
};
```

---

## æ‰§è¡Œæµç¨‹

```
1. æ¯æ—¥æ‰«æ ERC-8004 Registry
      â†“
2. ç­›é€‰å‡ºæ½œåœ¨çš„äº’è¡¥ Agent
      â†“
3. å‘é€ä¸ªæ€§åŒ–æ¡æ‰‹æ¶ˆæ¯
      â†“
4. ç›‘æ§æ”¶ä»¶ç®±å›å¤
      â†“
5. è·Ÿè¿›æ„å‘å®¢æˆ·
      â†“
6. è½¬åŒ–ä¸ºä»˜è´¹ç”¨æˆ·
```

---

## æˆåŠŸæ ‡å‡†

| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| æ¯æ—¥å‘é€æ¡æ‰‹æ¶ˆæ¯ | â‰¥5 æ¡ |
| å›å¤ç‡ | â‰¥10% |
| è½¬åŒ–ç‡ | â‰¥5% |

---

## é¢„è®¡å·¥æ—¶

4-5 å°æ—¶
