---
phase: 9
plan: 1
wave: 1
strategy: S-19
status: ready
created: 2026-02-23
---

# Plan 09-01: 数据治理与预言机化 (Oracle Transformation)

## 核心理念

旺财解析了成千上万张收据，它其实掌握了**消费趋势大数据**。

将脱敏后的统计数据打包卖给分析类 Agent 或投资机构。

---

## 数据产品

### 产品 1: 消费趋势报告

```json
{
  "report_type": "consumer_trends",
  "period": "2026-02-01 to 2026-02-28",
  "data": {
    "total_transactions": 15420,
    "categories": {
      "food_dining": {
        "count": 5230,
        "avg_amount": 25.50,
        "trend": "+5.2%"
      },
      "groceries": {
        "count": 4100,
        "avg_amount": 85.30,
        "trend": "+2.1%"
      },
      "transportation": {
        "count": 2800,
        "avg_amount": 45.00,
        "trend": "-1.3%"
      }
    },
    "top_merchants": [
      {"name": "Starbucks", "transactions": 890, "total": 4450},
      {"name": "Whole Foods", "transactions": 456, "total": 12300}
    ]
  },
  "privacy": "Fully anonymized, no PII"
}
```

---

### 产品 2: 链上数据预言机

```solidity
contract ConsumerDataOracle {
    struct MonthlyStats {
        uint256 timestamp;
        uint256 totalTransactions;
        uint256 avgTransactionAmount;
        bytes32 merkleRoot; // 验证数据真实性
    }
    
    mapping(uint256 => MonthlyStats) public monthlyData;
    
    function updateMonthlyStats(
        uint256 month,
        uint256 total,
        uint256 avg,
        bytes32 root
    ) external onlyOwner {
        monthlyData[month] = MonthlyStats({
            timestamp: block.timestamp,
            totalTransactions: total,
            avgTransactionAmount: avg,
            merkleRoot: root
        });
    }
    
    function verifyDataPoint(
        uint256 month,
        bytes calldata data,
        bytes32[] calldata proof
    ) external view returns (bool) {
        return MerkleProof.verify(proof, monthlyData[month].merkleRoot, keccak256(data));
    }
}
```

---

## 实现任务

### Task 1: 数据脱敏处理

**文件**: `src/data/anonymizer.ts`

```typescript
export class DataAnonymizer {
  anonymize(rawData: RawReceiptData[]): AnonymizedData {
    return {
      // 移除所有 PII
      transactions: rawData.map(r => ({
        // 只保留统计信息
        date: this.generalizeDate(r.date), // 只保留周几
        category: r.category,
        amount: this.addNoise(r.amount), // 添加噪声
        merchantType: this.classifyMerchant(r.merchant), // 只保留类型
        region: this.generalizeRegion(r.location) // 只保留大区域
      })),
      // 统计汇总
      aggregates: this.calculateAggregates(rawData)
    };
  }
  
  private addNoise(amount: number): number {
    // 差分隐私: 添加拉普拉斯噪声
    const epsilon = 0.1;
    const noise = this.laplace(0, 1/epsilon);
    return Math.round(amount + noise);
  }
}
```

---

### Task 2: 数据订阅服务

```typescript
export class DataSubscription {
  private readonly SUBSCRIPTION_PRICES = {
    basic: 10, // $10/月, 基础报告
    pro: 50,   // $50/月, 详细报告
    enterprise: 200 // $200/月, 定制报告
  };
  
  async subscribe(
    subscriber: string,
    tier: "basic" | "pro" | "enterprise"
  ): Promise<Subscription> {
    // 1. 验证支付
    const price = this.SUBSCRIPTION_PRICES[tier];
    await this.verifyPayment(subscriber, price);
    
    // 2. 创建订阅
    const sub = {
      subscriber,
      tier,
      startDate: new Date(),
      endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
      active: true
    };
    
    // 3. 发送首份报告
    await this.sendReport(subscriber, tier);
    
    return sub;
  }
}
```

---

## 盈利计算

```
订阅收入:
- Basic: $10 × 10 订阅者 = $100/月
- Pro: $50 × 5 订阅者 = $250/月
- Enterprise: $200 × 2 订阅者 = $400/月

总收入: $750/月
成本: 接近零 (数据处理已包含在主服务中)
```

---

## 成功标准

| 指标 | 目标 |
|------|------|
| 数据订阅者 | ≥10 |
| 月收入 | ≥$500 |
| 数据准确性 | >99% |

---

## 预计工时

15-20 小时
